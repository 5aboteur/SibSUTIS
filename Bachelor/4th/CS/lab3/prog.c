#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define N 10000000
#define n 10

double p[n][n] =
{
	0.1, 0.4, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.1, 0.4, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.1, 0.4, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.1, 0.4, 0.5, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.1, 0.4, 0.5, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.4, 0.5, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.4, 0.5, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.4, 0.5,
	0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.4,
	0.4, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1
};

double p2[n][n] =
{
	0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0,
	0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5,
	0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5
};

int histo[n] = { 0 };
int histo_x[n] = { 0 };

int main()
{
	srand((unsigned)time(NULL));

	int cur = 0, prev, idx;
	int cnt_mtx[n][n];
	double pp[n][n], ksi_mass[50];
	double ksi;

	FILE *fp = fopen("res", "w");

	for (int i = 0; i < n; ++i) {
		pp[i][0] = p[i][0];
		for (int j = 1; j < n; ++j) {
			pp[i][j] = p[i][j] + pp[i][j - 1];
		}
	}

	for (int z = 0; z < N; ++z) {
		prev = cur;
		double tmp = drand48();
		for (int i = 0; i < n; ++i) {
			if (tmp < pp[cur][i]) {
				cur = i;
				++histo[cur];

				ksi = drand48();
				ksi = -1.0 * (log(ksi));
				idx = (int)(ksi / 0.7);
				++histo_x[idx];
				break;
			}
		}
		if (z < 50) ksi_mass[z] = ksi;
	}

	fprintf(fp, "\n************\n\n");
	for (int i = 0; i < n; ++i) fprintf(fp, "%d\n", histo[i]);
	fprintf(fp, "\n************\n\n");
	for (int i = 0; i < n; ++i) fprintf(fp, "%d\n", histo_x[i]);
	fprintf(fp, "\n************\n\n");
	for (int i = 0; i < 50; ++i) fprintf(fp, "%.6lf\n", ksi_mass[i]);

	fclose(fp);
	return 0;
}
